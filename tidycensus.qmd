---
title: "census_var"
format: html
author: ElectriGrid
warning: false
message: false
---


This quarto document explores the Census ACS 5-year data utilizing the `tidycensus` package. The challenge is to narrow down the data from the 13,033 variables. The final output of this repository is a clean data frame to be utilized in the ElectriGrid MEDS capstone. The client has provided a list of variables of interest. 

**Home owner rate** 
 - B25011_001: Estimate Total Tenure by household type 
 - B25011_002: tenure_owner_occupied
 - B25011_026: tenure_renter_occupied
 - B25026_001: pop_in_occupied # total pop in occupied units
 - B25026_009: pop_renter_occupied
 - B25127_001: total_housing_units
 
 **Single family housing rate** 
 - B11011_004: married_one_unit # married-couple family, one-unit structures; single family housing rate
 - B11011_002: household_type_by_unit # family households/household type by units in structure
 
 **Education**  
 - B16010_041: pop_bach_or_higher
 - B16010_001: total_pop
 
 **Home value** 
 - B25107_001: Estimate Median value Total median value by year structure built
 - B25097_001: mortgage_status # dollars
 - B25107_001: median_value_by_year # value by year structure built
 
 **Income status**. 
 - B06011_001: median_family_income_2020 # past 12 months; 2020 inflation-adjusted
 - B19013A_001: median_family_income_white 
 - B19013B_001: median_family_income_black 
 - B19013C_001: median_family_income_american_indian
 - B19013D_001: median_family_income_asian
 - B19013F_001: median_family_income_other_race
 - B19013G_001: median_family_income_two_or_more_races
 - B19013I_001: median_family_income_latinos
 
 **Race**. 
 - B01001A_001: pop_white
 - B01001B_001: pop_black
 - B01001C_001: pop_american_indian
 - B01001D_001: pop_asian
 - B01001E_001: pop_hawaian_and_pacific_islander
 - B01001F_001: pop_other_race
 - B01001G_001: pop_two_or_more_races
 - B01001I_001: pop_latino
 
 **Mortgage**
 - B25027_001: total_mortgage
 - B25027_002: units_w_mortgage
 
 **Gini**
 - B19083_001: gini_index
 
 **Poverty**
 - B17001_002: income_poverty
 - B06012_004: above_poverty
 

```{r}
# load necessary libraries
library(tidyverse)
library(tidycensus)
library(janitor)
```

# Census variable

Download a csv with the variables for the census data.

```{r}
# access variable names to for selection of 
var20 <- load_variables(2020, "acs5", cache = TRUE)

#........................write data to csv.......................
write_csv(var20, file = here::here("census-data", "var20.csv")) 
```

There are slightly under 30,000 variables.

#### Clean the labels

Once the labels column is cleaned it can be utilized to filter down the variables. Here we keep only the numbers and letters.

```{r}
var20_clean <- var20 |> 
  # clean label column
  mutate(label = str_replace_all(label, "[^A-Za-z0-9]", " ")) 
```

There is no argument for the level of variables when downloading the csv so we'll filter down to census tract. This is also specified when calling data but let's subset here to see the true number of variables change with future filtering.

```{r}
tract_var20 <- var20_clean |> filter(geography == "tract")
```

We only need some of the census data not all 13,000 rows.


Create a list of all of the variables we are interested in for this analysis. 
```{r}
socioeconomic_var <- c("B25011_001",
                       "B25011_002",
                       "B25011_026",
                       "B25026_001", 
                       "B25026_009",
                       "B25127_001",
                       "B11011_004",
                       "B11011_002",
                       "B16010_041",
                       "B16010_001",
                       "B25107_001",
                       "B25097_001",
                       "B25107_001",
                       "B06011_001",
                       "B19013A_001",
                       "B19013B_001", 
                       "B19013C_001",
                       "B19013D_001",
                       "B19013F_001",
                       "B19013G_001",
                       "B19013I_001",
                       "B01001A_001",
                       "B01001B_001",
                       "B01001C_001",
                       "B01001D_001",
                       "B01001E_001",
                       "B01001F_001",
                       "B01001G_001",
                       "B01001I_001",
                       "B25027_001",
                       "B25027_002",
                       "B19083_001",
                       "B17001_002",
                       "B06012_004")
```

Access the data from the census catalogue giving it all of the variables we are interested in. 
```{r}
# access census data
census_data <- get_acs(geography = "tract", 
                        variables = socioeconomic_var,
                        geometry = TRUE,
                        state = "CA", 
                        year = 2020)

```
Join the downloaded census data with the variable names.
```{r}
census_w_var <- left_join(census_data, tract_var20, by= join_by(variable == name))
```

Both the label and concept column have important information about the values. Combine both of the columns so that the vital information is included. These can be further parsed later as needed. 
```{r}
census_w_var <- census_w_var |> 
  unite(col = "var_description", label, concept, remove = TRUE)
```

The output data is long so let's make the data tidy and only keep the columns we need for this analysis.
```{r}
tidy_census <- census_w_var |>
  clean_names() |> 
  select(geoid, name, estimate, var_description, geometry) |> 
 pivot_wider(names_from = var_description, values_from = c(estimate)) |> 
  clean_names()
```

Save the census data into a csv
```{r}
#........................write data to csv.......................
write_csv(tidy_census, file = here::here("census-data", "census_data.csv"))  
```
